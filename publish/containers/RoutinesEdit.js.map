{"version":3,"sources":["../../src/containers/RoutinesEdit.js"],"names":["RoutinesEdit","props","state","routine","code","title","duration","display","video","success","componentDidMount","id","routeParams","getRoutines","that","res","setState","content","componentDidUpdate","prevProps","prevState","save","event","preventDefault","postRoutines","putRoutines","result","back","info","msg","uploadFile","e","target","name","percentCompleted","process","after","setRoutine","getAttribute","value","router","goBack","render","bind","maxWidth","width","marginBottom","verticalAlign","contentUri","mapStateToProps","routines","mapDispatchToProps","dispatch"],"mappings":"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","file":"RoutinesEdit.js","sourcesContent":["/**\r\n * Created by qwr on 2017/9/14.\r\n */\r\nimport React, {Component, PropTypes} from 'react'\r\nimport Helmet from \"react-helmet\"\r\nimport {bindActionCreators} from 'redux'\r\nimport {connect} from 'react-redux'\r\nimport {withRouter} from \"react-router\";\r\nimport {upload} from '../common/fetch'\r\nimport {Col, Form, Pagination, Row} from \"react-bootstrap\"\r\nimport {routinesActions} from '../actions'\r\nimport Alert from '../components/Alert';\r\nclass RoutinesEdit extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            routine:{\r\n                code:'',\r\n                title:'',\r\n                duration:'',\r\n                display:true,\r\n                video:null,\r\n            },\r\n            success:false,\r\n        };\r\n    }\r\n    componentDidMount() {\r\n        var id=this.props.routeParams.id;\r\n        if(id!=0){\r\n            const {getRoutines} = this.props;\r\n            const that=this;\r\n            getRoutines({id:id},function (res) {\r\n                that.setState({\r\n                    routine:res.content,\r\n                })\r\n            })\r\n        }\r\n    }\r\n    componentDidUpdate(prevProps, prevState) {\r\n\r\n    }\r\n    save(event) {\r\n        event.preventDefault();\r\n        const {postRoutines,putRoutines} = this.props;\r\n        var routine = this.state.routine;\r\n        var that=this;\r\n        if(!routine.id){\r\n            postRoutines(routine,function (res) {\r\n                if(res.result.code==1){\r\n                    that.setState({\r\n                        success:true,\r\n                    })\r\n                    that.back();\r\n                }\r\n                Alert.info({info:res.result.msg});\r\n\r\n            });\r\n        }else{\r\n            putRoutines(routine,function (res) {\r\n                if(res.result.code==1){\r\n                    that.setState({\r\n                        success:true,\r\n                    })\r\n                }\r\n                Alert.info({info:res.result.msg});\r\n            });\r\n        }\r\n\r\n    }\r\n    uploadFile(e) {\r\n        const target = e.target;\r\n        const name = target.name;\r\n        const that = this;\r\n        var routine = this.state.routine;\r\n        upload(e,function (percentCompleted) {\r\n            that.setState({\r\n                process:(percentCompleted*100)+'%',\r\n            })\r\n        }).after(function (res) {\r\n            routine[name]=res[0];\r\n            that.setState(routine)\r\n        });\r\n    }\r\n    setRoutine(e){\r\n        var name = e.target.getAttribute('name');\r\n        var value = e.target.value;\r\n        var routine = this.state.routine;\r\n        if(name=='display'){\r\n            value=!routine.display;\r\n        }\r\n        routine[name]=value;\r\n        this.setState(routine);\r\n    }\r\n    back(){\r\n        this.props.router.goBack();\r\n    }\r\n    render() {\r\n        var routine=this.state.routine;\r\n        var success=this.state.success;\r\n        var process=this.state.process;\r\n        return (\r\n            <div>\r\n                <Helmet title=\"RoutinesEdit\"/>\r\n                <div className=\"box\">\r\n                    {success&&<div className=\"callout callout-success text-center\">Your changes have been succesfully saved</div>}\r\n                    <div className=\"box-header\">\r\n                        <h3 className=\"box-title\">Edit Routine</h3>\r\n                    </div>\r\n                    <Form role=\"form\"  onSubmit = {this.save.bind(this)}>\r\n                       <div className=\"box-body\">\r\n                           <Row>\r\n                               <Col lg={3} className=\"m-t10\">Routine ID:</Col>\r\n                               <Col lg={9} className=\"m-t10\">{routine.id}</Col>\r\n                           </Row>\r\n                           <Row>\r\n                               <Col lg={3} className=\"m-t10\">Number of times started:</Col>\r\n                               <Col lg={9} className=\"m-t10\"></Col>\r\n                           </Row>\r\n                           <Row>\r\n                               <Col lg={3} className=\"m-t10\">Number of times skipped:</Col>\r\n                               <Col lg={9} className=\"m-t10\"></Col>\r\n                           </Row>\r\n                        <Row className=\"m-t40\">\r\n                            <Col lg={3} className=\"m-t10\">\r\n                                <label  className=\"m-t5\">Routine Code:</label>\r\n                            </Col>\r\n                            <Col lg={9} className=\"m-t10\">\r\n                                <input type=\"text\"  className=\"form-control\" style={{maxWidth:'615px'}} required={true} placeholder=\"\" name=\"code\" value={routine.code} onChange={this.setRoutine.bind(this)}/>\r\n                            </Col>\r\n\r\n                            <Col lg={3} className=\"m-t10\">\r\n                                <label className=\"m-t5\">Routine Title:</label>\r\n                            </Col>\r\n                            <Col lg={9} className=\"m-t10\">\r\n                                <input type=\"text\"  className=\"form-control\" style={{maxWidth:'615px'}} required={true} placeholder=\"\" name=\"title\" value={routine.title} onChange={this.setRoutine.bind(this)}/>\r\n                            </Col>\r\n\r\n                            <Col lg={3} className=\"m-t10\">\r\n                                <label htmlFor=\"Code\" className=\"m-t5\">Routine Duration:</label>\r\n                            </Col>\r\n                            <Col lg={9} className=\"m-t10\">\r\n                                <input type=\"text\"  className=\"form-control\" style={{maxWidth:'615px'}} required={true} placeholder=\"\" name=\"duration\" value={routine.duration} onChange={this.setRoutine.bind(this)}/>\r\n                            </Col>\r\n                            <Col lg={3} className=\"m-t10\">\r\n                                <label htmlFor=\"Code\" className=\"m-t5\">Routine Video:</label>\r\n                            </Col>\r\n                            <Col lg={3} className=\"m-t10\">\r\n                                <input type=\"file\" name=\"video\"  onChange={this.uploadFile.bind(this)}/>\r\n\r\n                                {(process&&process!='100%')&&<div className=\"progress m-t5\" style={{width:'200px',marginBottom:'auto',verticalAlign:'middle'}}>\r\n                                    <div className=\"progress-bar\" role=\"progressbar\" aria-valuenow=\"50\" aria-valuemin=\"0\" aria-valuemax=\"100\" style={{width: this.state.process}}>\r\n                                    </div>\r\n                                </div>}\r\n                            </Col>\r\n                            <Col lg={6} className=\"m-t10\">\r\n                                {routine.video&&\r\n                                <video width={200} src={routine.video.contentUri} controls=\"controls\">\r\n                                    您的浏览器不支持 video 标签。\r\n                                </video>\r\n                                }\r\n                            </Col>\r\n                            <Col lg={12}>\r\n                                <div className=\"checkbox\">\r\n                                    <label>\r\n                                        <input type=\"checkbox\" name=\"display\" checked={routine.display}  onChange={this.setRoutine.bind(this)}/>Display in Workout detail page?\r\n                                    </label>\r\n                                </div>\r\n                            </Col>\r\n                        </Row>\r\n                    </div>\r\n\r\n                       <div className=\"box-footer clearfix\">\r\n                        <Row>\r\n                            <Col lg={12} className=\"col-md-offset-3\">\r\n                                <button type=\"submit\"  className=\"btn  btn-primary\" >Save</button>\r\n                                <button type=\"button\" className=\"btn btn-default m-l10\" onClick={this.back.bind(this)}>Back</button>\r\n                            </Col>\r\n                        </Row>\r\n                    </div>\r\n                    </Form>\r\n                </div>\r\n\r\n            </div>\r\n        )\r\n    }\r\n}\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        routines: state.routines\r\n    }\r\n}\r\n//将action的所有方法绑定到props上\r\nfunction mapDispatchToProps(dispatch) {\r\n    return bindActionCreators(routinesActions, dispatch)\r\n}\r\n\r\n//通过react-redux提供的connect方法将我们需要的state中的数据和actions中的方法绑定到props上\r\nexport default connect(mapStateToProps, mapDispatchToProps)(withRouter(RoutinesEdit))"]}