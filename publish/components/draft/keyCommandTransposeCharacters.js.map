{"version":3,"sources":["../../../src/components/draft/keyCommandTransposeCharacters.js"],"names":["DraftModifier","require","EditorState","getContentStateFragment","keyCommandTransposeCharacters","editorState","selection","getSelection","isCollapsed","offset","getAnchorOffset","blockKey","getAnchorKey","content","getCurrentContent","block","getBlockForKey","length","getLength","removalRange","finalSelection","set","movedFragment","afterRemoval","removeRange","selectionAfter","getSelectionAfter","targetOffset","targetRange","merge","anchorOffset","focusOffset","afterInsert","replaceWithFragment","newEditorState","push","acceptSelection","module","exports"],"mappings":"AAAA;;;;;;;;;;;;AAYA;;AAEA,IAAIA,gBAAgBC,QAAQ,iBAAR,CAApB;AACA,IAAIC,cAAcD,QAAQ,eAAR,CAAlB;;AAEA,IAAIE,0BAA0BF,QAAQ,2BAAR,CAA9B;;AAEA;;;;;AAKA,SAASG,6BAAT,CAAuCC,WAAvC,EAAoD;AAClD,MAAIC,YAAYD,YAAYE,YAAZ,EAAhB;AACA,MAAI,CAACD,UAAUE,WAAV,EAAL,EAA8B;AAC5B,WAAOH,WAAP;AACD;;AAED,MAAII,SAASH,UAAUI,eAAV,EAAb;AACA,MAAID,WAAW,CAAf,EAAkB;AAChB,WAAOJ,WAAP;AACD;;AAED,MAAIM,WAAWL,UAAUM,YAAV,EAAf;AACA,MAAIC,UAAUR,YAAYS,iBAAZ,EAAd;AACA,MAAIC,QAAQF,QAAQG,cAAR,CAAuBL,QAAvB,CAAZ;AACA,MAAIM,SAASF,MAAMG,SAAN,EAAb;;AAEA;AACA,MAAID,UAAU,CAAd,EAAiB;AACf,WAAOZ,WAAP;AACD;;AAED,MAAIc,YAAJ;AACA,MAAIC,cAAJ;;AAEA,MAAIX,WAAWQ,MAAf,EAAuB;AACrB;AACAE,mBAAeb,UAAUe,GAAV,CAAc,cAAd,EAA8BZ,SAAS,CAAvC,CAAf;AACAW,qBAAiBd,SAAjB;AACD,GAJD,MAIO;AACLa,mBAAeb,UAAUe,GAAV,CAAc,aAAd,EAA6BZ,SAAS,CAAtC,CAAf;AACAW,qBAAiBD,aAAaE,GAAb,CAAiB,cAAjB,EAAiCZ,SAAS,CAA1C,CAAjB;AACD;;AAED;AACA;AACA,MAAIa,gBAAgBnB,wBAAwBU,OAAxB,EAAiCM,YAAjC,CAApB;AACA,MAAII,eAAevB,cAAcwB,WAAd,CAA0BX,OAA1B,EAAmCM,YAAnC,EAAiD,UAAjD,CAAnB;;AAEA;AACA,MAAIM,iBAAiBF,aAAaG,iBAAb,EAArB;AACA,MAAIC,eAAeF,eAAef,eAAf,KAAmC,CAAtD;AACA,MAAIkB,cAAcH,eAAeI,KAAf,CAAqB;AACrCC,kBAAcH,YADuB;AAErCI,iBAAaJ;AAFwB,GAArB,CAAlB;;AAKA,MAAIK,cAAchC,cAAciC,mBAAd,CAAkCV,YAAlC,EAAgDK,WAAhD,EAA6DN,aAA7D,CAAlB;;AAEA,MAAIY,iBAAiBhC,YAAYiC,IAAZ,CAAiB9B,WAAjB,EAA8B2B,WAA9B,EAA2C,iBAA3C,CAArB;;AAEA,SAAO9B,YAAYkC,eAAZ,CAA4BF,cAA5B,EAA4Cd,cAA5C,CAAP;AACD;;AAEDiB,OAAOC,OAAP,GAAiBlC,6BAAjB","file":"keyCommandTransposeCharacters.js","sourcesContent":["/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule keyCommandTransposeCharacters\n * \n */\n\n'use strict';\n\nvar DraftModifier = require('./DraftModifier');\nvar EditorState = require('./EditorState');\n\nvar getContentStateFragment = require('./getContentStateFragment');\n\n/**\n * Transpose the characters on either side of a collapsed cursor, or\n * if the cursor is at the end of the block, transpose the last two\n * characters.\n */\nfunction keyCommandTransposeCharacters(editorState) {\n  var selection = editorState.getSelection();\n  if (!selection.isCollapsed()) {\n    return editorState;\n  }\n\n  var offset = selection.getAnchorOffset();\n  if (offset === 0) {\n    return editorState;\n  }\n\n  var blockKey = selection.getAnchorKey();\n  var content = editorState.getCurrentContent();\n  var block = content.getBlockForKey(blockKey);\n  var length = block.getLength();\n\n  // Nothing to transpose if there aren't two characters.\n  if (length <= 1) {\n    return editorState;\n  }\n\n  var removalRange;\n  var finalSelection;\n\n  if (offset === length) {\n    // The cursor is at the end of the block. Swap the last two characters.\n    removalRange = selection.set('anchorOffset', offset - 1);\n    finalSelection = selection;\n  } else {\n    removalRange = selection.set('focusOffset', offset + 1);\n    finalSelection = removalRange.set('anchorOffset', offset + 1);\n  }\n\n  // Extract the character to move as a fragment. This preserves its\n  // styling and entity, if any.\n  var movedFragment = getContentStateFragment(content, removalRange);\n  var afterRemoval = DraftModifier.removeRange(content, removalRange, 'backward');\n\n  // After the removal, the insertion target is one character back.\n  var selectionAfter = afterRemoval.getSelectionAfter();\n  var targetOffset = selectionAfter.getAnchorOffset() - 1;\n  var targetRange = selectionAfter.merge({\n    anchorOffset: targetOffset,\n    focusOffset: targetOffset\n  });\n\n  var afterInsert = DraftModifier.replaceWithFragment(afterRemoval, targetRange, movedFragment);\n\n  var newEditorState = EditorState.push(editorState, afterInsert, 'insert-fragment');\n\n  return EditorState.acceptSelection(newEditorState, finalSelection);\n}\n\nmodule.exports = keyCommandTransposeCharacters;"]}