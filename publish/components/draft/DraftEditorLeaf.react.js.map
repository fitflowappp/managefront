{"version":3,"sources":["../../../src/components/draft/DraftEditorLeaf.react.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_get","get","_x","_x2","_x3","_again","_function","object","property","receiver","Function","desc","undefined","parent","value","getter","call","_classCallCheck","instance","TypeError","_inherits","subClass","superClass","constructor","__proto__","DraftEditorTextNode","require","React","ReactDOM","SelectionState","setDraftEditorSelection","DraftEditorLeaf","_React$Component","apply","arguments","_setSelection","selection","getHasFocus","_props","blockKey","start","text","end","hasEdgeWithin","node","findDOMNode","child","firstChild","targetNode","nodeType","Node","TEXT_NODE","tagName","shouldComponentUpdate","nextProps","refs","leaf","textContent","styleSet","forceSelection","componentDidUpdate","componentDidMount","render","endsWith","isLast","_props2","customStyleMap","offsetKey","styleObj","reduce","map","styleName","mergedStyles","style","textDecoration","join","createElement","ref","Component","module","exports"],"mappings":"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","file":"DraftEditorLeaf.react.js","sourcesContent":["/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule DraftEditorLeaf.react\n * @typechecks\n * \n */\n\n'use strict';\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nvar _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar DraftEditorTextNode = require('./DraftEditorTextNode.react');\nvar React = require('react');\nvar ReactDOM = require('react-dom');\nvar SelectionState = require('./SelectionState');\n\nvar setDraftEditorSelection = require('./setDraftEditorSelection');\n\n/**\n * All leaf nodes in the editor are spans with single text nodes. Leaf\n * elements are styled based on the merging of an optional custom style map\n * and a default style map.\n *\n * `DraftEditorLeaf` also provides a wrapper for calling into the imperative\n * DOM Selection API. In this way, top-level components can declaratively\n * maintain the selection state.\n */\n\nvar DraftEditorLeaf = (function (_React$Component) {\n  _inherits(DraftEditorLeaf, _React$Component);\n\n  function DraftEditorLeaf() {\n    _classCallCheck(this, DraftEditorLeaf);\n\n    _get(Object.getPrototypeOf(DraftEditorLeaf.prototype), 'constructor', this).apply(this, arguments);\n  }\n\n  _createClass(DraftEditorLeaf, [{\n    key: '_setSelection',\n\n    /**\n     * By making individual leaf instances aware of their context within\n     * the text of the editor, we can set our selection range more\n     * easily than we could in the non-React world.\n     *\n     * Note that this depends on our maintaining tight control over the\n     * DOM structure of the TextEditor component. If leaves had multiple\n     * text nodes, this would be harder.\n     */\n    value: function _setSelection() {\n      var selection = this.props.selection;\n\n      // If selection state is irrelevant to the parent block, no-op.\n      if (selection == null || !selection.getHasFocus()) {\n        return;\n      }\n\n      var _props = this.props;\n      var blockKey = _props.blockKey;\n      var start = _props.start;\n      var text = _props.text;\n\n      var end = start + text.length;\n      if (!selection.hasEdgeWithin(blockKey, start, end)) {\n        return;\n      }\n\n      // Determine the appropriate target node for selection. If the child\n      // is not a text node, it is a <br /> spacer. In this case, use the\n      // <span> itself as the selection target.\n      var node = ReactDOM.findDOMNode(this);\n      var child = node.firstChild;\n      var targetNode = undefined;\n\n      if (child.nodeType === Node.TEXT_NODE) {\n        targetNode = child;\n      } else if (child.tagName === 'BR') {\n        targetNode = node;\n      } else {\n        targetNode = child.firstChild;\n      }\n\n      setDraftEditorSelection(selection, targetNode, blockKey, start, end);\n    }\n  }, {\n    key: 'shouldComponentUpdate',\n    value: function shouldComponentUpdate(nextProps) {\n      return ReactDOM.findDOMNode(this.refs.leaf).textContent !== nextProps.text || nextProps.styleSet !== this.props.styleSet || nextProps.forceSelection;\n    }\n  }, {\n    key: 'componentDidUpdate',\n    value: function componentDidUpdate() {\n      this._setSelection();\n    }\n  }, {\n    key: 'componentDidMount',\n    value: function componentDidMount() {\n      this._setSelection();\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var text = this.props.text;\n\n      // If the leaf is at the end of its block and ends in a soft newline, append\n      // an extra line feed character. Browsers collapse trailing newline\n      // characters, which leaves the cursor in the wrong place after a\n      // shift+enter. The extra character repairs this.\n      if (text.endsWith('\\n') && this.props.isLast) {\n        text += '\\n';\n      }\n\n      var _props2 = this.props;\n      var customStyleMap = _props2.customStyleMap;\n      var offsetKey = _props2.offsetKey;\n      var styleSet = _props2.styleSet;\n\n      var styleObj = styleSet.reduce(function (map, styleName) {\n        var mergedStyles = {};\n        var style = customStyleMap[styleName];\n\n        if (style !== undefined && map.textDecoration !== style.textDecoration) {\n          mergedStyles.textDecoration = [map.textDecoration, style.textDecoration].join(' ');\n        }\n\n        return Object.assign(map, style, mergedStyles);\n      }, {});\n\n      return React.createElement(\n        'span',\n        {\n          'data-offset-key': offsetKey,\n          ref: 'leaf',\n          style: styleObj },\n        React.createElement(\n          DraftEditorTextNode,\n          null,\n          text\n        )\n      );\n    }\n  }]);\n\n  return DraftEditorLeaf;\n})(React.Component);\n\nmodule.exports = DraftEditorLeaf;\n\n// A function passed through from the the top level to define a cx\n// style map for the provided style value.\n\n// Mapping of style names to CSS declarations.\n\n// Whether to force the DOM selection after render.\n\n// Whether this leaf is the last in its block. Used for a DOM hack.\n\n// The current `SelectionState`, used to\n\n// The offset of this string within its block.\n\n// The set of style(s) names to apply to the node.\n\n// The full text to be rendered within this node."]}