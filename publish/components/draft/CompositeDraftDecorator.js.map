{"version":3,"sources":["../../../src/components/draft/CompositeDraftDecorator.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","Immutable","require","List","DELIMITER","CompositeDraftDecorator","decorators","_decorators","slice","value","getDecorations","block","decorations","Array","getText","fill","forEach","decorator","ii","counter","strategy","start","end","canOccupySlice","occupySlice","getComponentForKey","componentKey","parseInt","split","component","getPropsForKey","targetArr","module","exports"],"mappings":"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","file":"CompositeDraftDecorator.js","sourcesContent":["/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @providesModule CompositeDraftDecorator\n * @typechecks\n * \n */\n\n'use strict';\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nvar Immutable = require('immutable');\n\nvar List = Immutable.List;\n\nvar DELIMITER = '.';\n\n/**\n * A CompositeDraftDecorator traverses through a list of DraftDecorator\n * instances to identify sections of a ContentBlock that should be rendered\n * in a \"decorated\" manner. For example, hashtags, mentions, and links may\n * be intended to stand out visually, be rendered as anchors, etc.\n *\n * The list of decorators supplied to the constructor will be used in the\n * order they are provided. This allows the caller to specify a priority for\n * string matching, in case of match collisions among decorators.\n *\n * For instance, I may have a link with a `#` in its text. Though this section\n * of text may match our hashtag decorator, it should not be treated as a\n * hashtag. I should therefore list my link DraftDecorator\n * before my hashtag DraftDecorator when constructing this composite\n * decorator instance.\n *\n * Thus, when a collision like this is encountered, the earlier match is\n * preserved and the new match is discarded.\n */\n\nvar CompositeDraftDecorator = (function () {\n  function CompositeDraftDecorator(decorators) {\n    _classCallCheck(this, CompositeDraftDecorator);\n\n    // Copy the decorator array, since we use this array order to determine\n    // precedence of decoration matching. If the array is mutated externally,\n    // we don't want to be affected here.\n    this._decorators = decorators.slice();\n  }\n\n  /**\n   * Determine whether we can occupy the specified slice of the decorations\n   * array.\n   */\n\n  _createClass(CompositeDraftDecorator, [{\n    key: 'getDecorations',\n    value: function getDecorations(block) {\n      var decorations = Array(block.getText().length).fill(null);\n\n      this._decorators.forEach(function ( /*object*/decorator, /*number*/ii) {\n        var counter = 0;\n        var strategy = decorator.strategy;\n        strategy(block, function ( /*number*/start, /*number*/end) {\n          // Find out if any of our matching range is already occupied\n          // by another decorator. If so, discard the match. Otherwise, store\n          // the component key for rendering.\n          if (canOccupySlice(decorations, start, end)) {\n            occupySlice(decorations, start, end, ii + DELIMITER + counter);\n            counter++;\n          }\n        });\n      });\n\n      return List(decorations);\n    }\n  }, {\n    key: 'getComponentForKey',\n    value: function getComponentForKey(key) {\n      var componentKey = parseInt(key.split(DELIMITER)[0], 10);\n      return this._decorators[componentKey].component;\n    }\n  }, {\n    key: 'getPropsForKey',\n    value: function getPropsForKey(key) {\n      var componentKey = parseInt(key.split(DELIMITER)[0], 10);\n      return this._decorators[componentKey].props;\n    }\n  }]);\n\n  return CompositeDraftDecorator;\n})();\n\nfunction canOccupySlice(decorations, start, end) {\n  for (var ii = start; ii < end; ii++) {\n    if (decorations[ii] != null) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Splice the specified component into our decoration array at the desired\n * range.\n */\nfunction occupySlice(targetArr, start, end, componentKey) {\n  for (var ii = start; ii < end; ii++) {\n    targetArr[ii] = componentKey;\n  }\n}\n\nmodule.exports = CompositeDraftDecorator;"]}